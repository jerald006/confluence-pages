<!DOCTYPE html>
<html>
    <head>
        <title>XeniApp : Xeni Clean Up</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">XeniApp</a></span>
                            </li>
                                                    <li>
                                <span><a href="XeniApp_542179373.html">XeniApp</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            XeniApp : Xeni Clean Up
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Sarika</span> on Mar 17, 2023
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><strong>Introduction</strong></p><p>The current system is not in a good state as it does not allow adding new concepts easily.</p><p>The tests that have been written are just API tests and not unit tests and do not add real value to the system.</p><p><strong>Why is it a priority?</strong></p><p>Things that will be almost impossible without code cleanup(refactoring):</p><ul><li><p>Adding new features</p></li><li><p>Integrating new 3rd party services</p></li><li><p>Debugging and fixing issues in production</p></li><li><p>Speeding up the development of new features</p></li><li><p>Scaling the application for thousands of users</p></li><li><p>Speeding up app response time</p></li><li><p>Handling failure and edge cases as currently only happy paths are handled</p></li><li><p>Building a stable system</p></li><li><p>Test code based on business logic</p></li></ul><p><strong>List of issues</strong></p><ul><li><p>Idempotency issue in booking - would be resolved once we integrate to new api</p></li><li><p>Atomicity issue in booking - new apis multicart will resolve this issue</p></li><li><p>Frontend controlling the booking amount, no validation of the same in backend - new apis</p></li><li><p>Business logic is segregated in frontend and backend - Will be taken care in Tech sprint</p></li><li><p>Issue in Error handling resulting in loss of business for Xeni - addressed (Ayush to verify) - Completed</p></li><li><p>Broken bridge between Xeni and Xenipay (Retries not present) - addressed (Ayush to verify) - completed</p></li><li><p>Code is too tightly coupled to introduce new concepts (example: booking issue with bitpay) - Will be taken care in Tech sprint</p></li><li><p>Code cleanup required in all systems - react and superadmin needs to be done - Tech sprint</p></li><li><p>E2E logging, monitoring and APM - Sentry is being used here - we will come back</p></li><li><p>Devops automation in Xenipay - Kavi will take care of it with Ayush</p></li><li><p>Proper unit testing / code coverage - add tests on react and superadmin, add JP and Thanos to reviewerâ€™s list - tech sprint(not 100% sure)</p></li><li><p>API rate-limiting issue</p><ul><li><p>find rate-limits with all vendors - Sonali to work on it with service vendors</p></li></ul></li><li><p>graceful shutdown</p></li><li><p>System Recovery operations - making recovery faster research and development - Completed</p></li><li><p><del>Need to make this an event-driven microservice gradually.</del></p></li><li><p>Consolidator onboarding vs getting list from Xenipay - completed</p></li><li><p>SSO for the entire system - extend existing sso logic to xenipay </p></li><li><p>Customer mapping on Xenipay - Currently the customers that are created in Xenipay are not properly mapped to the OTA they are created on, as a result, technically an OTA can access details of any customer. - not needed currently</p></li><li><p>Internationalisation challenge - Supporting Internationalisation on the current platform will be a big task - in progress</p></li><li><p>Different UI for mobile and desktop. Need to identify the reason for the same and work on making it liquid responsive - Important but will need more time. Dedicated UX</p></li><li><p>Caching is missing in the system which will create load on the system with increasing number of concurrent sessions - Tech sprint</p></li><li><p>Cancel booking integration in Xenipay is pending - completed</p></li><li><p>Bitpay refund? How to handle? - Needs confirmation</p></li><li><p>Auto-settle notification to Xeniapp from Xenipay is pending. - Xenipay pending</p></li><li><p>Business and Technical Documentation - add comments in code</p></li><li><p>Should we extract Payment Module as a separate service that can work independent of Xeniapp? - new API</p></li><li><p>Hotel booking API cleanup</p></li><li><p>Refactor Frontend</p></li></ul><p><strong>Execution Plan</strong></p><p><strong>Refactor XeniApp</strong></p><p><strong>Read all configs from a single file</strong></p><p>Move all the process.env to a single config file.</p><p><strong>Reason</strong></p><ul><li><p>This allows application configuration to be isolated from application logic. Instead of having a dependency on the environment config, we can easily change where a configuration value is being read from.</p></li><li><p>The code becomes decoupled from system configuration. Also, we can identify issues even before the application starts allowing us to have a proper setup.</p></li></ul><p><strong>Create Custom errors</strong></p><p>Instead of throwing messages, throwing custom errors help debugging the code faster.</p><p><strong>Reason</strong></p><p>This will save tons of time finding what is causing the error as it gives more information when an error occurs.</p><p><strong>Extract DB Queries</strong></p><p>Move all database operations to a separate folder and use those when needed.</p><p><strong>Reason</strong></p><p>Database operations are happening randomly at whatever place database operations are being done. This couples the code with tightly with database operations. If there is a change in the databsae structure, then each and every place has to be changed to suit that change.</p><p><strong>Fix Route structure</strong></p><p>The routes used in the application are not well reflected by the folder structure. The current structure does not help in finding the route easily as it is segregated based on versions. Instead, the versioning should happen inside the corresponding route.</p><p>The structure should be based on various entities of the domain rather than versions.</p><p><strong>Reason</strong></p><ul><li><p>There is no easy way to figure out if a particular operation resides in v1 or v2 or v3. One has to manually go through each of the version files to find an endopint.</p></li><li><p>Instead, if versions resided inside a single file, it will make it easier to debug and version control as well.</p></li></ul><p><strong>Place 3rd party services in one folder</strong></p><p>All the 3rd party services should be placed in their own folder where they have all the operations related to it inside. Currently, the services are scattered all over the place with their operations being defined in random places.</p><p><strong>Reason</strong></p><ul><li><p>When 3rd party services are placed in its own folder, we can easily understand the interfaces that are available to us. This allows us to decouple the code as well as replace or add new services providing similar functionality independent of other code. Also, it becomes easier to change the services without affecting the code.</p></li><li><p>If a 3rd party service provider changes their response data, the current architecture will break causing the entire application to crash.</p></li></ul><p><strong>Put response messages in a single file</strong></p><p>Currently, the messages that are being returned to the user are written in the same place as where the operation occurs. This does not allow us to quickly change a message text if needed.</p><p><strong>Reason</strong></p><p>Helps in internationalization as all messages will be in a single place instead of all over the place. We can simply pass all the messages for allowing globalization of messages being sent to the user.</p><p><strong>Change .then to async/await</strong></p><p>Debugging and changing logic of an application becomes very hard. Since .then results in lots of nesting and unnecessary complexity.</p><p>It can easily be replaced by async/await</p><p><strong>Global Response Handler</strong></p><p>The responses that are being sent to the user are controlled by the operation that is handling the application flow.</p><p><strong>Reason</strong></p><p>We do not have control over the response that is being sent from the application. A central controller should handle all the responses and make sure that there is a structure to it.</p><p><strong>Document the database models</strong></p><p><strong>Separate Business logic from controller</strong></p><p>All of the business logic and server logic is written in the same place. They should be separated into their own areas.</p><p><strong>Reason</strong></p><p>The business logic and the application logic should be separate. Coupling the two makes it extremely difficult to have a stable application.</p><p><strong>Remove multiple CRONs for BitPay</strong></p><p>Have a single CRON instead of multiple ones for bookings</p><p><strong>Creating a Payment System</strong></p><p>Separate payments into its own service to manage payments.</p><p><strong>Reason</strong></p><p>There was a problem with BitPay because of tight coupling in the code. Adding new concepts was really hard as the previous code didn't allow changing the flow. Data was flowing without a structure between various operations.</p><p>Payments is the key and the most sensitive operation in the system, but there are no fail safes in the system. Payment mechanisms should ideally be separated into their own operation instead of making it a part of the business logic.</p><p>There are many unanswered questions such as - What happens if a booking is made, but the payment did not go through? What happens if payment takes a while to be processed, but the booking is confirmed? If a booking is confirmed, payment made, but the booking isn't stored in XeniPay, what needs to be done?</p><p>All of these unhandled cases will cause lots of bugs and issues which could not be manually handled once the system reaches a lot of users. This will also stop Xeni from being stable.</p><p />
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 24, 2024 07:18</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
