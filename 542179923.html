<!DOCTYPE html>
<html>
    <head>
        <title>XeniApp : Postmortem: Prod down-time due to AMI change</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">XeniApp</a></span>
                            </li>
                                                    <li>
                                <span><a href="XeniApp_542179373.html">XeniApp</a></span>
                            </li>
                                                    <li>
                                <span><a href="Reports_542181424.html">Reports</a></span>
                            </li>
                                                    <li>
                                <span><a href="Postmortem-Report_542179894.html">Postmortem Report</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            XeniApp : Postmortem: Prod down-time due to AMI change
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Ronak Jain (Unlicensed)</span>, last modified on Apr 01, 2022
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="Postmortem:Proddown-timeduetoAMIchange-Postmortem:Proddown-timeduetoAMIchange">Postmortem: Prod down-time due to AMI change </h2><p><strong>Date</strong>: 2022-03-23</p><p><strong>Authors</strong>: Ronak</p><p><strong>Status</strong>: action items in progress</p><p><strong>Summary</strong>: Xeni API Server was down for 78 minutes. During this period <a class="external-link" href="http://Xeniapp.com" rel="nofollow">Xeniapp.com</a> and all of the tenant websites were not available.</p><p><strong>Impact</strong>: Potential revenue loss, this incident would no longer have us on 99.99% availability league.</p><p><strong>Root Causes</strong>: </p><ol><li><p>It was the DevOps Engineers’ first production deployment and there was a clear knowledge gap that caused this issue.</p></li><li><p>After production deployment, a sanity check was not done by the DevOps Engineers, which resulted in a delayed resolution</p></li><li><p>The DevOps Engineers should have sought explicit approval from leads before performing a prod deploy.</p></li></ol><p><strong>Trigger</strong>: terraform apply via console.</p><p><strong>Resolution</strong>: The resolution was to deploy the API code by rerunning GitHub actions after the successful terraform apply.</p><p><strong>Detection</strong>: <a class="confluence-userlink user-mention" data-account-id="61392cac156ab3007187e8c3" href="https://xeni-workspace.atlassian.net/wiki/people/61392cac156ab3007187e8c3?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User 7e8c3</a> detected this issue at 10.58 AM EST</p><p><strong>Action Items</strong>:</p><div class="table-wrap"><table data-layout="default" data-local-id="7e6e9562-786e-4837-8b40-fa318817288e" class="confluenceTable"><colgroup><col style="width: 170.0px;"/><col style="width: 170.0px;"/><col style="width: 170.0px;"/><col style="width: 170.0px;"/></colgroup><tbody><tr><th class="confluenceTh"><p>Action Item</p></th><th class="confluenceTh"><p>Type</p></th><th class="confluenceTh"><p>Owner(s)</p></th><th class="confluenceTh"><p><strong>Status</strong></p></th></tr><tr><td class="confluenceTd"><p>Try to make production <code>tf apply</code> workflow double opt-in instead of current single accept</p></td><td class="confluenceTd"><p>prevent</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="5f17e016e5efc1001be84ea8" href="https://xeni-workspace.atlassian.net/wiki/people/5f17e016e5efc1001be84ea8?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ronak Jain (Unlicensed)</a> <a class="confluence-userlink user-mention" data-account-id="6200b7f48df9a200718d2ef1" href="https://xeni-workspace.atlassian.net/wiki/people/6200b7f48df9a200718d2ef1?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User d2ef1</a> <a class="confluence-userlink user-mention" data-account-id="604a8dc6b2ea120115b9c8a4" href="https://xeni-workspace.atlassian.net/wiki/people/604a8dc6b2ea120115b9c8a4?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Dheeraj Naithani (Unlicensed)</a> <a class="confluence-userlink user-mention" data-account-id="60c0938e20d2dd007024383a" href="https://xeni-workspace.atlassian.net/wiki/people/60c0938e20d2dd007024383a?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Rajesh (Unlicensed)</a> </p></td><td class="confluenceTd"><p>Not possible.</p></td></tr><tr><td class="confluenceTd"><p>Make all the Devops engineer understand the current git flow. </p></td><td class="confluenceTd"><p>process</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="5f17e016e5efc1001be84ea8" href="https://xeni-workspace.atlassian.net/wiki/people/5f17e016e5efc1001be84ea8?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ronak Jain (Unlicensed)</a> <a class="confluence-userlink user-mention" data-account-id="604a8dc603ceda0069bd747b" href="https://xeni-workspace.atlassian.net/wiki/people/604a8dc603ceda0069bd747b?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">vaibhav (Unlicensed)</a> </p></td><td class="confluenceTd"><p>DONE</p></td></tr><tr><td class="confluenceTd"><p>Research if we could auto-trigger last production build on successful <code>tf apply</code></p></td><td class="confluenceTd"><p>prevent</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="5f17e016e5efc1001be84ea8" href="https://xeni-workspace.atlassian.net/wiki/people/5f17e016e5efc1001be84ea8?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ronak Jain (Unlicensed)</a> </p></td><td class="confluenceTd"><p /></td></tr><tr><td class="confluenceTd"><p>Document prod deploy process clearly for engineers. </p></td><td class="confluenceTd"><p>process</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="5f17e016e5efc1001be84ea8" href="https://xeni-workspace.atlassian.net/wiki/people/5f17e016e5efc1001be84ea8?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ronak Jain (Unlicensed)</a> , <a class="confluence-userlink user-mention" data-account-id="604a8dc603ceda0069bd747b" href="https://xeni-workspace.atlassian.net/wiki/people/604a8dc603ceda0069bd747b?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">vaibhav (Unlicensed)</a> </p></td><td class="confluenceTd"><p>DONE</p></td></tr><tr><td class="confluenceTd"><p>Auto start pm2 process when the server reboots</p></td><td class="confluenceTd"><p>prevent</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="6200b7f48df9a200718d2ef1" href="https://xeni-workspace.atlassian.net/wiki/people/6200b7f48df9a200718d2ef1?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User d2ef1</a> </p></td><td class="confluenceTd"><p>Sprint-13</p></td></tr><tr><td class="confluenceTd"><p>Take session for the entire team to on Cloudwatch alarms and SOPs</p></td><td class="confluenceTd"><p>process</p></td><td class="confluenceTd"><p><a class="confluence-userlink user-mention" data-account-id="5f17e016e5efc1001be84ea8" href="https://xeni-workspace.atlassian.net/wiki/people/5f17e016e5efc1001be84ea8?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ronak Jain (Unlicensed)</a> </p></td><td class="confluenceTd"><p>DONE</p></td></tr></tbody></table></div><h2 id="Postmortem:Proddown-timeduetoAMIchange-LessonsLearned">Lessons Learned</h2><p><strong>What went well</strong></p><ul><li><p>None</p></li></ul><p><strong>What went wrong</strong></p><ul><li><p>Other Engineering members such as <a class="confluence-userlink user-mention" data-account-id="5f97a08244658b007112ee94" href="https://xeni-workspace.atlassian.net/wiki/people/5f97a08244658b007112ee94?ref=confluence" target="_blank" data-linked-resource-id="440762370" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://xeni-workspace.atlassian.net/wiki">Ayush Kumar</a> , <a class="confluence-userlink user-mention" data-account-id="60f8f853d01349006957c674" href="https://xeni-workspace.atlassian.net/wiki/people/60f8f853d01349006957c674?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User 7c674</a>, <a class="confluence-userlink user-mention" data-account-id="61a85f14b43d5b006a726736" href="https://xeni-workspace.atlassian.net/wiki/people/61a85f14b43d5b006a726736?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">Arun Karthik (Unlicensed)</a>, <a class="confluence-userlink user-mention" data-account-id="61d3ab8890cfd20071fc6d9e" href="https://xeni-workspace.atlassian.net/wiki/people/61d3ab8890cfd20071fc6d9e?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User c6d9e</a>, <a class="confluence-userlink user-mention" data-account-id="607d5545de34400071731e67" href="https://xeni-workspace.atlassian.net/wiki/people/607d5545de34400071731e67?ref=confluence" target="_blank" data-linked-resource-id="398295042" data-linked-resource-version="1" data-linked-resource-type="userinfo" data-base-url="https://xeni-workspace.atlassian.net/wiki">sonali</a>, <a class="confluence-userlink user-mention" data-account-id="6200b7f48df9a200718d2ef1" href="https://xeni-workspace.atlassian.net/wiki/people/6200b7f48df9a200718d2ef1?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User d2ef1</a>   didn’t respond to the Cloudwatch alarm.</p></li><li><p>Devops Engineer doing a prod deploy during US working hours.</p></li><li><p>Despite having 3-4 KT sessions with Kavi and Ronak, there was still a knowledge gap.</p></li></ul><p><strong>Where we got lucky</strong></p><ul><li><p><a class="confluence-userlink user-mention" data-account-id="61392cac156ab3007187e8c3" href="https://xeni-workspace.atlassian.net/wiki/people/61392cac156ab3007187e8c3?ref=confluence" target="_blank" data-base-url="https://xeni-workspace.atlassian.net/wiki">User 7e8c3</a> raising an alarm</p></li></ul><h2 id="Postmortem:Proddown-timeduetoAMIchange-Timeline">Timeline</h2><p>2022-03-23 <em>(all times EST)</em></p><ul><li><p>02:00 AM EST - In anticipation of an upcoming production deployment, Ronak planned to deploy the new AMI Image in UAT and PROD. Ronak requested DevOps engineer to deploy the AMI to UAT and then to Prod.</p></li><li><p>04:00 AM EST - DevOps Engineer deployed the new image into UAT environment, Ronak has triggered a UAT GitHub actions re-run. This pushed the API code to the UAT serers. Ronak informs the DevOps engineer about it and asks the DevOps engineer to proceed with Prod deploy.</p></li><li><p>9.45 AM EST - DevOps engineer triggers a production deploy, he wasn’t available earlier due to personal emergency.</p></li><li><p><strong>10.00 AM EST OUTAGE BEGINS</strong> — API Server is down</p></li><li><p>10.07 AM EST - Cloudwatch raises an alarm</p></li><li><p>10.58 AM EST - Sarika raises an Alarm</p></li><li><p>11.00 AM EST - DevOps engineer ask the dev channel to deploy the code to prod</p></li><li><p>11.10 AM EST - Rajesh deploys the code to prod.</p></li><li><p><strong>11:18 AM EST OUTAGE MITIGATED</strong>, outage mitigated</p></li></ul>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Jun 24, 2024 07:15</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
